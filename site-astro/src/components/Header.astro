---
const pathname = Astro.url.pathname;
const basePath = import.meta.env.BASE_URL || '/';

const NAV_ITEMS = [
  { path: '/', label: 'Start' },
  { path: '/stunden/', label: 'Stunden' },
  { path: '/uebungen/', label: 'Ãœbungen' },
  { path: '/info/', label: 'Info' }
];

function isActive(path: string): boolean {
  const normalizedPathname = pathname.replace(basePath, '/');
  if (path === '/') {
    return normalizedPathname === '/' || normalizedPathname === '';
  }
  return normalizedPathname.startsWith(path);
}
---

<header class="glass-header" role="banner">
  <div class="container header-inner">
    <!-- Logo -->
    <a href={basePath} class="header-logo" aria-label="RehaSport Reader Startseite">
      <span class="header-logo-icon" aria-hidden="true">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z" />
          <path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12" />
        </svg>
      </span>
      <span class="hidden sm:inline">RehaSport</span>
    </a>

    <!-- Navigation -->
    <nav class="header-nav" aria-label="Hauptnavigation">
      {NAV_ITEMS.map((item) => (
        <a
          href={`${basePath}${item.path.slice(1)}`}
          class:list={['nav-link', { active: isActive(item.path) }]}
        >
          {item.label}
        </a>
      ))}
    </nav>

    <!-- Theme Switcher -->
    <div class="header-actions">
      <button
        type="button"
        class="btn btn-ghost btn-icon"
        id="theme-toggle"
        aria-label="Theme wechseln"
        title="Theme wechseln"
      >
        <span class="theme-icon-light" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="4" />
            <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41" />
          </svg>
        </span>
        <span class="theme-icon-dark" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" />
          </svg>
        </span>
      </button>
    </div>
  </div>
</header>

<style>
  :root[data-theme="light"] .theme-icon-light,
  :root[data-theme="dark"] .theme-icon-dark {
    display: none;
  }
  :root[data-theme="light"] .theme-icon-dark,
  :root[data-theme="dark"] .theme-icon-light {
    display: block;
  }
  .hidden {
    display: none;
  }
  @media (min-width: 640px) {
    .sm\:inline {
      display: inline;
    }
  }
</style>

<script>
  const toggle = document.getElementById('theme-toggle');

  toggle?.addEventListener('click', () => {
    const current = document.documentElement.dataset.theme;
    const next = current === 'dark' ? 'light' : 'dark';
    document.documentElement.dataset.theme = next;
    localStorage.setItem('theme', next);
  });
</script>
